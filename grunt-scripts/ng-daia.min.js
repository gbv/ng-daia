angular.module("ngDAIA",[]).value("ngDAIA.version","0.1.3"),angular.module("ngDAIA").directive("daiaApi",["$http","$filter",function($http,$filter){return{restrict:"A",scope:{api:"@daiaApi",id:"@daiaId",filter:"@daiaFilter"},templateUrl:function(elem,attrs){return attrs.templateUrl?attrs.templateUrl:"daiaSimple"==attrs.daiaFilter?"template/daia-simple.html":"template/daia-response.html"},link:function(scope){scope.daiaRequest=function(){scope.filter?angular.forEach($filter(scope.filter)({}),function(value,key){scope[key]=null}):scope.daia={},$http.jsonp(scope.api,{params:{id:scope.id,format:"json",callback:"JSON_CALLBACK"}}).success(function(response){scope.filter?angular.forEach($filter(scope.filter)(response),function(value,key){scope[key]=value}):scope.daia=response})},scope.$watch("api",function(){scope.daiaRequest()}),scope.$watch("id",function(){scope.daiaRequest()})}}}]),angular.module("ngDAIA").directive("daiaAvailability",function(){return{restrict:"A",scope:{item:"=daiaAvailability"},templateUrl:function(elem,attrs){return attrs.templateUrl?attrs.templateUrl:"template/daia-availability.html"},link:function(scope){scope.item.available&&scope.item.available.length&&(scope.available=scope.item.available),scope.item.unavailable&&scope.item.unavailable.length&&(scope.unavailable=scope.item.unavailable)}}}),angular.module("ngDAIA").directive("daiaItem",function(){return{restrict:"A",scope:{item:"=daiaItem"},templateUrl:function(elem,attrs){return attrs.templateUrl?attrs.templateUrl:"template/daia-item.html"}}}),angular.module("ngDAIA").directive("daiaSimple",["$filter",function($filter){return{restrict:"A",scope:{daia:"=daiaSimple"},templateUrl:function(elem,attrs){return attrs.templateUrl?attrs.templateUrl:"template/daia-simple.html"},link:function(scope){scope.$watch("daia",function(){var simple=$filter("daiaSimple")(scope.daia);angular.forEach(["service","available","expected","delay","href","limitation","queue"],function(key){scope[key]=simple[key]})})}}}]),angular.module("ngDAIA").filter("daiaSimple",function(){return function(input){var services=["openaccess","loan","presentation"],items=[];angular.isObject(input)&&(angular.isArray(input.document)?angular.forEach(input.document,function(document){angular.forEach(document.item,function(item){items.push(item)})}):angular.isArray(input.item)?angular.forEach(input.item,function(item){items.push(item)}):items.push(input));var response={service:"none",available:!1,delay:null,expected:null,queue:null,href:null,limitation:null};if(services.some(function(service){return items.some(function(item){var a=angular.isArray(item.available)?item.available:[];return a.some(function(available){return available.service==service?(response.available=!0,["service","href","limitation","delay"].forEach(function(key){var value=available[key];(value||0==value)&&(response[key]=value)}),response.limitation&&(response.limitation=response.limitation[0].content),!0):void 0})})}))return response;var expect;return items.forEach(function(item){var a=angular.isArray(item.unavailable)?item.unavailable:[];a.forEach(function(unavail){var uexp=unavail.expected;-1!=services.indexOf(unavail.service)&&uexp&&(!expect||"unknown"==expect||"unknown"!=uexp&&expect>uexp)&&(["service","href","limitation","expected","queue"].forEach(function(key){var value=unavail[key];(value||0==value)&&(response[key]=value)}),response.limitation&&(response.limitation=response.limitation[0].content))})}),expect?response:(services.some(function(){}),response)}}),angular.module("ngDAIA").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("template/daia-availability.html",'<ul class="availability" ng-if="available || unavailable"><li ng-if="available" ng-repeat="a in available"><span class="service-label" translate="{{a.service}}">{{a.service}}</span> <span class="availability availability-available" translate="available">available</span> <span class="availability availability-limitation" ng-if="a.limitation">({{a.limitation[0].content}})</span></li><li ng-if="unavailable" ng-repeat="u in unavailable"><span class="service-label" ng-if="u.expected" translate="{{u.service}}">{{u.service}}</span> <span ng-if="u.expected" class="availability availability-expected" translate="expected">expected</span> <span class="service-label" ng-if="!u.expected" translate="{{u.service}}">{{u.service}}</span> <span ng-if="!u.expected" class="availability availability-unavailable" translate="unavailable">unavailable</span></li><div class="returning"><li ng-if="unavailable[0].href && unavailable[0].expected"><div ng-if="unavailable[0].expected" class="returning returning-expected"><span translate="EXPECTED_BACK">expected back:</span> {{unavailable[0].expected}}</div><a href="{{unavailable[0].href}}" translate="RESERVATION">place reservation</a></li></div></ul><div class="access" ng-if="((available[1].service || available[0].service) == \'openaccess\' || unavailable[0].service == \'openaccess\')"><span translate="ACCESS">access via:</span> <a ng-if="available[1].service == \'openaccess\'" href="{{available[1].href}}">{{available[1].href}}</a> <a ng-if="unavailable[0].service == \'openaccess\'" href="{{unavailable[0].href}}">{{available[0].href}}</a></div>'),$templateCache.put("template/daia-item.html",'<div ng-if="item.department"><span class="daia-label" translate="DEPARTMENT">Department:</span> <a ng-if="item.department.href" href="{{item.department.href}}">{{item.department.content}}</a> <span ng-if="!item.department.href">{{item.department.content}}</span></div><div ng-if="item.label"><span class="daia-label" translate="SIGNATURE">Shelf mark:</span> {{item.label}}</div><span ng-if="!item.available && !item.unavailable" class="daia-label" translate="AVAILABILITY">Availability:</span> <span ng-if="!item.available && !item.unavailable" translate="unknown">unknown</span><div daia-availability="item"></div>'),$templateCache.put("template/daia-response.html",'<div class="daia-result"><div ng-if="daia.institution.content"><span class="daia-label" translate="INSTITUTION">institution:</span> <a ng-if="daia.institution.href" href="{{daia.institution.href}}">{{daia.institution.content}}</a></div><div ng-if="daia.document[0].href"><span class="daia-label" translate="DOCUMENT">document:</span> <a translate="CATALOG_ENTRY" href="{{daia.document[0].href}}">Catalog entry</a></div><div><span ng-if="!daia.document" translate="NO_RECORDS">no records found</span></div><div ng-if="daia.document" daia-documents="daia.document"><div class="daia-document" ng-repeat="i in daia.document[0].item"><div daia-item="i"></div></div></div></div>'),$templateCache.put("template/daia-simple.html",'<span ng-if="available"><span ng-switch="service"><span ng-switch-when="openaccess"><span class="availability-available">frei verf端gbar</span> <a ng-if="href" href="{{href}}">aufrufen</a></span> <span ng-switch-when="loan"><span class="availability-available">ausleihbar</span> <a ng-if="href" href="{{href}}">bestellen</a></span> <span ng-switch-when="presentation"><span class="availability-available">vor Ort verf端gbar</span> <a ng-if="href" href="{{href}}">bestellen</a></span> <span ng-switch-default><span class="availability-available">verf端gbar</span> <a ng-if="href" href="{{href}}">bestellen</a></span></span> <span ng-if="delay">(Wartezeit<span ng-if="delay != \'unknown\'">etwa {{delay}}</span>)</span> <span ng-if="limitation">| <span class="daia-limitation">{{limitation}}</span></span></span> <span ng-if="!available"><span class="availability-unavailable"><span ng-if="expected">momentan</span> nicht verf端gbar</span> <span ng-if="expected && expected != \'unknown\'">bis voraussichtlich {{expected}}</span> <span ng-if="href"><a href="{{href}}">vormerken</a></span> <span ng-if="queue">({{queue}} Vormerkungen)</span> <span ng-if="limitation">| <span class="daia-limitation">{{limitation}}</span></span></span>')}]);